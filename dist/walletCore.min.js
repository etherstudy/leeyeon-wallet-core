!function(t){var e={};function n(l){if(e[l])return e[l].exports;var a=e[l]={i:l,l:!1,exports:{}};return t[l].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=t,n.c=e,n.d=function(t,e,l){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:l})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var l=Object.create(null);if(n.r(l),Object.defineProperty(l,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(l,a,function(e){return t[e]}.bind(null,a));return l},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e){window.wallet=new function(){this.web3=null,this.callback=null,this.keyObject=null,this.contract={},this.balances={},this.erc20abi=[{constant:!0,inputs:[],name:"name",outputs:[{name:"",type:"string"}],payable:!1,type:"function"},{constant:!0,inputs:[],name:"decimals",outputs:[{name:"",type:"uint8"}],payable:!1,type:"function"},{constant:!0,inputs:[{name:"_owner",type:"address"}],name:"balanceOf",outputs:[{name:"balance",type:"uint256"}],payable:!1,type:"function"},{constant:!0,inputs:[],name:"symbol",outputs:[{name:"",type:"string"}],payable:!1,type:"function"}],this.start=function(){return window.wallet.loadJson("wallet.json",(t,e)=>{t?console.log(t):(window.wallet.option=e,"http"==window.wallet.option.type?(window.wallet.web3=new Web3(new Web3.providers.HttpProvider(window.wallet.option.network[window.wallet.option.type])),setInterval(()=>{window.wallet.update(),window.wallet.callback&&window.wallet.callback()},6e4)):(window.wallet.web3=new Web3(new Web3.providers.WebsocketProvider(window.wallet.option.network[window.wallet.option.type])),window.wallet.web3.eth.subscribe("newBlockHeaders",()=>{window.wallet.update(),window.wallet.callback&&window.wallet.callback()})),window.wallet.balances["0x0"]={contract:null,balance:-1,name:"ETH",icon:'<i class="fab fa-ethereum"></i>'},window.wallet.addERC20s(e.erc20s,0),window.wallet.createContracts(),window.wallet.update(),console.log("web3 :"+window.wallet.web3.version))}),wallet},this.addERC20s=function(t,e){if(e<t.length){let n=t[e];window.wallet.balances[n[0]]||(window.wallet.balances[n[0]]={contract:new window.wallet.web3.eth.Contract(window.wallet.erc20abi,n[0]),balance:-1,name:n[1],icon:n[2]},""==n[1]?window.wallet.balances[n[0]].contract.methods.name().call((l,a)=>{l||(window.wallet.balances[n[0]].name=a),window.wallet.addERC20s(t,e+1)}):window.wallet.addERC20s(t,e+1))}},this.pushContract=function(t,e){window.wallet.contract[e]||(window.wallet.contract[e]={a:t,c:window.wallet.web3?new window.wallet.web3.eth.Contract(t,e):null})},this.createContracts=function(){if(window.wallet.web3)for(var t in window.wallet.contract)window.wallet.contract[t].c||(window.wallet.contract[t].c=new window.wallet.web3.eth.Contract(window.wallet.contract[t].a,t))},this.update=function(){if(window.wallet.address())for(let t in window.wallet.balances)window.wallet.getBalance(t,window.wallet.callback)},this.getBalance=function(t,e){window.wallet.address()&&("0x0"==t?window.wallet.web3.eth.getBalance(window.wallet.address(),(n,l)=>{n||(window.wallet.balances[t].balance=parseInt(l),e&&e())}):window.wallet.balances[t]&&window.wallet.balances[t].contract.methods.balanceOf(window.wallet.address()).call((n,l)=>{n||(window.wallet.balances[t].balance=parseInt(l),e&&e())}))},this.create=function(t,e){let n=keythereum.create(),l=keythereum.dump(t,n.privateKey,n.salt,n.iv);e&&e(l)},this.login=function(t,e,n,l){if(window.wallet.web3)try{window.wallet.keyObject=e,keythereum.recover(t,e),window.wallet.update(),window.wallet.callback&&window.wallet.callback(),l&&l(window.wallet.address())}catch(t){window.wallet.keyObject=null,n&&n(t)}else n&&n("web3 error")},this.address=function(){return window.wallet.keyObject?"0x"+window.wallet.keyObject.address:null},this.addressQR=function(){return'<img src="https://api.qrserver.com/v1/create-qr-code/?data='+window.wallet.address()+'&size=256x256 alt="" width="256" height="256"/>'},this.addressLNK=function(){return window.wallet.option.network.href+"/address/"+window.wallet.address()},this.txLNK=function(t){return window.wallet.option.network.href+"/tx/"+t},this.isAddress=function(t){return!!window.wallet.web3&&window.wallet.web3.utils.isAddress(t)},this.logout=function(t,e){window.wallet.keyObject=null,e&&e("logout")},this.transfer=function(t,e,n,l,a=null,w=null,o=null){window.wallet.address()&&window.wallet.getBalance(n,()=>{l=window.wallet.web3.utils.toWei(l,"ether"),window.wallet.balances[n].balance>l?"0x0"==n?window.wallet.sendTx(t,e,l,null,a,w,o):window.wallet.sendTx(t,e,0,window.wallet.web3.utils.toWei(0,"ether"),window.wallet.balances[n].contract.methods.transfer(l).encodeABI(),a,w,o):a&&a("Out of balance")})},this.sendTx=function(t,e,n,l=null,a=null,w=null,o=null){if(window.wallet.address()){let i=window.wallet.getPrivateKeyString(e);null!=i&&window.wallet.isAddress(t)?window.wallet.web3.eth.getGasPrice((e,s)=>{if(null!=e)a&&a("Fail get gas price");else{let e={from:window.wallet.address(),to:t,value:window.wallet.web3.utils.toHex(n)};null!=l&&(e.data=l),window.wallet.web3.eth.estimateGas(e).then(t=>{e.gasPrice=window.wallet.web3.utils.toHex(parseInt(s)),e.gasLimit=window.wallet.web3.utils.toHex(parseInt(t)),window.wallet.web3.eth.accounts.privateKeyToAccount("0x"+i).signTransaction(e).then(t=>{window.wallet.web3.eth.sendSignedTransaction(t.rawTransaction).on("transactionHash",t=>{w&&w(t)}).then(t=>{o&&o(t),window.wallet.update()}).catch(t=>{a&&a(t)})})})}}):a&&window.wallet.isAddress(t)&&a("Wrong password")}},this.getPrivateKeyString=function(t){let e=null;try{let n=keythereum.recover(t,window.wallet.keyObject);e=Array.prototype.map.call(n,t=>("00"+t.toString(16)).slice(-2)).join("")}catch(t){e=null}return e},this.txHistory=function(t,e){window.wallet.address()&&("0x0"==t?window.wallet.txNormal(window.wallet.address(),t=>{window.wallet.txInternal(window.wallet.address(),n=>{let l=t.concat(n);l.sort(function(t,e){return parseInt(e.blockNumber)-parseInt(t.blockNumber)}),e(l)})}):window.wallet.txERC20(t,window.wallet.address(),e))},this.txNormal=function(t,e){let n=window.wallet.option.network.api+"/api?module=account&action=txlist&address="+t+"&startblock=0&endblock=latest&sort=desc";window.wallet.loadJson(n,(t,n)=>{t||e(n.result)})},this.txInternal=function(t,e){let n=window.wallet.option.network.api+"/api?module=account&action=txlistinternal&address="+t+"&startblock=0&endblock=latest&sort=desc";window.wallet.loadJson(n,(t,n)=>{t||e(n.result)})},this.txERC20=function(t,e,n){let l=window.wallet.option.network.api+"/api?module=account&action=tokentx&contractaddress="+t+"&address="+e+"&startblock=0&endblock=latest&sort=asc";window.wallet.loadJson(l,(t,e)=>{t||n(e.result)})},this.logs=function(t,e,n){let l=window.wallet.option.network.api+"/api?module=logs&action=getLogs&fromBlock=0&toBlock=latest&address="+t;""!=e&&(l+="&"+e),window.wallet.loadJson(l,(t,e)=>{t||n(e.result)})},this.loadJson=function(t,e){var n=new XMLHttpRequest;n.onreadystatechange=function(){n.readyState===XMLHttpRequest.DONE&&(200===n.status?e&&e(null,JSON.parse(n.responseText)):e&&e(n,null))},n.open("GET",t,!0),n.send()},this.findABI=function(t,e){let n=t.find(t=>t.name==e);return n||null}},t.exports=window.wallet.start()}]);